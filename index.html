<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ETS2 Vertical Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      background:#0d0d0d; 
      color:#f0f0f0; 
      font-family:sans-serif; 
      margin:0; 
      padding:20px; 
      display:flex; 
      flex-direction:column; 
      align-items:center;
    }
    h1 { 
      text-align:center; 
      color:#00ffcc; 
      margin-bottom:20px;
    }
    .kpi {
      background:#1a1a1a;
      color:#00ffcc;
      padding:20px;
      border-radius:12px;
      margin:10px 0;
      width:90%;
      text-align:center;
      font-size:1.4em;
      box-shadow:0 0 10px rgba(0,255,204,0.3);
    }
    canvas { 
      background:#1a1a1a; 
      border-radius:12px; 
      margin:15px 0; 
      padding:15px; 
      width:90% !important; 
      max-width:800px; 
      height:400px !important; 
      box-shadow:0 0 15px rgba(0,0,0,0.5);
    }
    table {
      width: 90%;
      max-width: 900px;
      border-collapse: collapse;
      margin-top: 30px;
      background: #1a1a1a;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,255,204,0.3);
    }
    th, td {
      border: 1px solid #00ffcc;
      padding: 10px;
      text-align: left;
      color: #00ffcc;
      font-size: 0.9em;
    }
    th {
      background-color: #004d40;
    }
    #map {
      margin-top: 40px;
      width: 90%;
      max-width: 900px;
      height: 400px;
      background: #111;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #00ffcc;
      font-size: 1.2em;
      font-style: italic;
      user-select: none;
    }
  </style>
</head>
<body>

  <h1>ðŸš› FRXGZ Ultimate Company Dashboard ðŸš›</h1>
  
  <div class="kpi" id="kpiTrucks">Loading trucks...</div>
  <div class="kpi" id="kpiDrivers">Loading drivers...</div>
  <div class="kpi" id="kpiIncome">Loading income...</div>
  <div class="kpi" id="kpiFuel">Loading fuel...</div>
  <div class="kpi" id="kpiGarages">Loading garages...</div>
  <div class="kpi" id="kpiTrailers">Loading trailers...</div>

  <canvas id="fuelChart"></canvas>
  <canvas id="repairsChart"></canvas>
  <canvas id="driverScoreChart"></canvas>
  <canvas id="incomeChart"></canvas>

  <h2>Past Jobs (Transactions)</h2>
  <table id="transactionsTable">
    <thead><tr id="transactionsHeader"></tr></thead>
    <tbody id="transactionsBody"></tbody>
  </table>

  <h2>Visited Countries Map</h2>
  <div id="map">Map visualization placeholder</div>

  <script>
  // CSV URLs
  const trucksCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSq1GLbDENEZYWCjhdfY_lbazkfiEI6ISOffmP2QBOr_0gGAlRYaNc3uDQ22ZeHaaQa2UtOoXYDSYV2/pub?gid=146602917&single=true&output=csv";
  const driversCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSq1GLbDENEZYWCjhdfY_lbazkfiEI6ISOffmP2QBOr_0gGAlRYaNc3uDQ22ZeHaaQa2UtOoXYDSYV2/pub?gid=1310443753&single=true&output=csv";
  const garagesCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSq1GLbDENEZYWCjhdfY_lbazkfiEI6ISOffmP2QBOr_0gGAlRYaNc3uDQ22ZeHaaQa2UtOoXYDSYV2/pub?gid=1425443368&single=true&output=csv";
  const trailersCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSq1GLbDENEZYWCjhdfY_lbazkfiEI6ISOffmP2QBOr_0gGAlRYaNc3uDQ22ZeHaaQa2UtOoXYDSYV2/pub?gid=620180317&single=true&output=csv";
  const transactionsCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSq1GLbDENEZYWCjhdfY_lbazkfiEI6ISOffmP2QBOr_0gGAlRYaNc3uDQ22ZeHaaQa2UtOoXYDSYV2/pub?gid=726275393&single=true&output=csv";

  async function loadCSV(url) {
    const resp = await fetch(url);
    const text = await resp.text();
    const lines = text.trim().split('\n');
    const headers = lines.shift().split(',');
    return lines.map(line => {
      const values = line.split(',');
      return headers.reduce((obj, header, idx) => {
        obj[header.trim()] = values[idx] ? values[idx].trim() : "";
        return obj;
      }, {});
    });
  }

  function renderTable(data, tableId, headerId, bodyId) {
    if (!data.length) {
      document.getElementById(tableId).innerHTML = '<tr><td>No data found</td></tr>';
      return;
    }

    const headers = Object.keys(data[0]);
    const headerRow = document.getElementById(headerId);
    const tbody = document.getElementById(bodyId);

    // Clear any existing
    headerRow.innerHTML = "";
    tbody.innerHTML = "";

    headers.forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      headerRow.appendChild(th);
    });

    data.forEach(row => {
      const tr = document.createElement('tr');
      headers.forEach(h => {
        const td = document.createElement('td');
        td.textContent = row[h] || "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  async function buildDashboard() {
    // Load CSV data
    const [trucks, drivers, garages, trailers, transactions] = await Promise.all([
      loadCSV(trucksCSV),
      loadCSV(driversCSV),
      loadCSV(garagesCSV),
      loadCSV(trailersCSV),
      loadCSV(transactionsCSV)
    ]);

    // KPIs
    const totalIncome = trucks.reduce((sum, t) => sum + parseFloat(t["Monthly Income"] || 0), 0);
    const avgFuel = trucks.reduce((sum, t) => sum + parseFloat(t["Fuel L/100km"] || 0), 0) / (trucks.length || 1);

    document.getElementById("kpiTrucks").innerText = `ðŸšš Total Trucks: ${trucks.length}`;
    document.getElementById("kpiDrivers").innerText = `ðŸ‘¨â€âœˆï¸ Total Drivers: ${drivers.length}`;
    document.getElementById("kpiIncome").innerText = `ðŸ’° Monthly Income: â‚¬${totalIncome.toLocaleString()}`;
    document.getElementById("kpiFuel").innerText = `â›½ Avg Fuel Consumption: ${avgFuel.toFixed(2)} L/100km`;
    document.getElementById("kpiGarages").innerText = `ðŸ¢ Garages: ${garages.length}`;
    document.getElementById("kpiTrailers").innerText = `ðŸš› Trailers: ${trailers.length}`;

    // Charts data
    const labels = trucks.map((t, i) => `${t["Model"]} #${i+1}`);
    const fuelCosts = trucks.map(t => parseFloat(t["Est Monthly Fuel Cost"] || 0));
    const repairs = trucks.map(t => parseFloat(t["Repair / 12 (avg monthly)"] || 0));
    const income = trucks.map(t => parseFloat(t["Monthly Income"] || 0));

    new Chart(document.getElementById("fuelChart"), {
      type: "bar",
      data: { labels, datasets: [{ label: "Fuel (â‚¬)", data: fuelCosts, backgroundColor: "#ff4444" }] },
      options: { plugins: { legend: { labels: { color: "#f0f0f0" } } }, scales: { x: { ticks: { color: "#f0f0f0" } }, y: { ticks: { color: "#f0f0f0" } } } }
    });

    new Chart(document.getElementById("repairsChart"), {
      type: "bar",
      data: { labels, datasets: [{ label: "Repairs (â‚¬)", data: repairs, backgroundColor: "#ffaa00" }] },
      options: { plugins: { legend: { labels: { color: "#f0f0f0" } } }, scales: { x: { ticks: { color: "#f0f0f0" } }, y: { ticks: { color: "#f0f0f0" } } } }
    });

    new Chart(document.getElementById("driverScoreChart"), {
      type: "radar",
      data: {
        labels: drivers.map(d => d["Name"]),
        datasets: [{
          label: "Driver Score",
          data: drivers.map(d => parseFloat(d["Driver Score (0-100)"] || 0)),
          borderColor: "#ffaa00",
          backgroundColor: "rgba(255,170,0,0.2)"
        }]
      },
      options: { plugins: { legend: { labels: { color: "#f0f0f0" } } }, scales: { r: { pointLabels: { color: "#f0f0f0" }, ticks: { color: "#f0f0f0" } } } }
    });

    new Chart(document.getElementById("incomeChart"), {
      type: "line",
      data: { labels, datasets: [{ label: "Monthly Income (â‚¬)", data: income, borderColor: "#00ff66", backgroundColor: "rgba(0,255,102,0.2)" }] },
      options: { plugins: { legend: { labels: { color: "#f0f0f0" } } }, scales: { x: { ticks: { color: "#f0f0f0" } }, y: { ticks: { color: "#f0f0f0" } } } }
    });

    // Render past jobs from transactions sheet in table
    renderTable(transactions, 'transactionsTable', 'transactionsHeader', 'transactionsBody');

    // TODO: Implement your map visualization here
  }

  buildDashboard();
  </script>
</body>
</html>
